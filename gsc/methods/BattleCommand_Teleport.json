{"names":["BattleCommand_Teleport"],"callingMethods":[],"methodsCalled":["AnimateFailedMove","BattleCommand_LowerSub","BattleRandom","DelayFrames","GetBattleVar","LoadMoveAnim","PrintButItFailed","SetBattleDraw","StdBattleTextbox","UpdateBattleMonInParty"],"methodAddressesUsed":[],"varsSet":["wForcedSwitch","wKickCounter","wNumHits"],"varsUsed":["hBattleTurn","wBattleMode","wBattleMonLevel","wBattleType","wCurPartyLevel"],"varAddressesUsed":[],"constantsUsed":["BATTLE_VARS_SUBSTATUS5_OPP"],"lines":["BattleCommand_Teleport:","; teleport","","\tld a, [wBattleType]","\tcp BATTLETYPE_SHINY","\tjr z, .failed","\tcp BATTLETYPE_TRAP","\tjr z, .failed","\tcp BATTLETYPE_CELEBI","\tjr z, .failed","\tcp BATTLETYPE_SUICUNE","\tjr z, .failed","","\tld a, BATTLE_VARS_SUBSTATUS5_OPP","\tcall GetBattleVar","\tbit SUBSTATUS_CANT_RUN, a","\tjr nz, .failed","; Only need to check these next things if it\u0027s your turn","\tldh a, [hBattleTurn]","\tand a","\tjr nz, .enemy_turn","; Can\u0027t teleport from a trainer battle","\tld a, [wBattleMode]","\tdec a","\tjr nz, .failed","; If your level is greater than the opponent\u0027s, you run without fail.","\tld a, [wCurPartyLevel]","\tld b, a","\tld a, [wBattleMonLevel]","\tcp b","\tjr nc, .run_away","; Generate a number between 0 and (YourLevel + TheirLevel).","\tadd b","\tld c, a","\tinc c",".loop_player","\tcall BattleRandom","\tcp c","\tjr nc, .loop_player","; If that number is greater than 4 times your level, run away.","\tsrl b","\tsrl b","\tcp b","\tjr nc, .run_away","",".failed","\tcall AnimateFailedMove","\tjp PrintButItFailed","",".enemy_turn","\tld a, [wBattleMode]","\tdec a","\tjr nz, .failed","\tld a, [wBattleMonLevel]","\tld b, a","\tld a, [wCurPartyLevel]","\tcp b","\tjr nc, .run_away","\tadd b","\tld c, a","\tinc c",".loop_enemy","\tcall BattleRandom","\tcp c","\tjr nc, .loop_enemy","\tsrl b","\tsrl b","\tcp b","\t; This should be jr c, .failed","\t; As written, it makes enemy use of Teleport always succeed if able","\tjr nc, .run_away",".run_away","\tcall UpdateBattleMonInParty","\txor a","\tld [wNumHits], a","\tinc a","\tld [wForcedSwitch], a","\tld [wKickCounter], a","\tcall SetBattleDraw","\tcall BattleCommand_LowerSub","\tcall LoadMoveAnim","\tld c, 20","\tcall DelayFrames","\tcall SetBattleDraw","","\tld hl, FledFromBattleText","\tjp StdBattleTextbox"],"name":"BattleCommand_Teleport","file":"engine/battle/move_effects/teleport.asm","lineNo":1,"address":121542,"addressUsedBy":[]}