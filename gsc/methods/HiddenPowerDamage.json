{"names":["HiddenPowerDamage"],"callingMethods":[],"methodsCalled":["FarCall","GetBattleVarAddr"],"methodAddressesUsed":["BattleCommand_DamageStats"],"varsSet":[],"varsUsed":["hBattleTurn"],"varAddressesUsed":["wBattleMonDVs","wEnemyMonDVs"],"constantsUsed":["BATTLE_VARS_MOVE_TYPE"],"lines":["HiddenPowerDamage:","; Override Hidden Power\u0027s type and power based on the user\u0027s DVs.","","\tld hl, wBattleMonDVs","\tldh a, [hBattleTurn]","\tand a","\tjr z, .got_dvs","\tld hl, wEnemyMonDVs",".got_dvs","","; Power:","","; Take the top bit from each stat","","\t; Attack","\tld a, [hl]","\tswap a","\tand %1000","","\t; Defense","\tld b, a","\tld a, [hli]","\tand %1000","\tsrl a","\tor b","","\t; Speed","\tld b, a","\tld a, [hl]","\tswap a","\tand %1000","\tsrl a","\tsrl a","\tor b","","\t; Special","\tld b, a","\tld a, [hl]","\tand %1000","\tsrl a","\tsrl a","\tsrl a","\tor b","","; Multiply by 5","\tld b, a","\tadd a","\tadd a","\tadd b","","; Add Special \u0026 3","\tld b, a","\tld a, [hld]","\tand %0011","\tadd b","","; Divide by 2 and add 30 + 1","\tsrl a","\tadd 30","\tinc a","","\tld d, a","","; Type:","","\t; Def \u0026 3","\tld a, [hl]","\tand %0011","\tld b, a","","\t; + (Atk \u0026 3) \u003c\u003c 2","\tld a, [hl]","\tand %0011 \u003c\u003c 4","\tswap a","\tadd a","\tadd a","\tor b","","; Skip Normal","\tinc a","","; Skip Bird","\tcp BIRD","\tjr c, .done","\tinc a","","; Skip unused types","\tcp UNUSED_TYPES","\tjr c, .done","\tadd SPECIAL - UNUSED_TYPES","",".done","","; Overwrite the current move type.","\tpush af","\tld a, BATTLE_VARS_MOVE_TYPE","\tcall GetBattleVarAddr","\tpop af","\tld [hl], a","","; Get the rest of the damage formula variables","; based on the new type, but keep base power.","\tld a, d","\tpush af","\tfarcall BattleCommand_DamageStats ; damagestats","\tpop af","\tld d, a","\tret"],"name":"HiddenPowerDamage","file":"engine/battle/hidden_power.asm","lineNo":1,"address":252856,"addressUsedBy":["BattleCommand_HiddenPower","AI_Smart_HiddenPower"]}