{"names":["TryToRunAwayFromBattle"],"callingMethods":["AskUseNextPokemon","BattleMenu_Run"],"methodsCalled":["BattleRandom","CheckMobileBattleError","CompareBytes","Divide","FarCall","GetItemName","LinkBattleSendReceiveAction","LoadTilemapToTempTilemap","Multiply","SafeLoadTempTilemapToTilemap","SetPlayerTurn","StdBattleTextbox","StopDangerSound","WaitPlaySFX","WaitSFX"],"methodAddressesUsed":["GetItemHeldEffect"],"varsSet":["hDividend","hDivisor","hEnemyMonSpeed","hMultiplicand","hMultiplier","hQuotient","wBattlePlayerAction","wBattleResult","wCurMoveNum","wCurPlayerMove","wFailedToFlee","wNamedObjectIndexBuffer","wNumFleeAttempts"],"varsUsed":["hEnemyMonSpeed","hProduct","hQuotient","wBattleAction","wBattleMode","wBattleMonItem","wBattleResult","wBattleType","wEnemySubStatus5","wLinkMode","wNumFleeAttempts","wPlayerWrapCount"],"varAddressesUsed":["BattleText_UserFledUsingAStringBuffer1","hEnemyMonSpeed","hMultiplicand","wcd2a"],"constantsUsed":["BATTLEPLAYERACTION_USEITEM","DRAW","SFX_RUN","TRUE"],"lines":["TryToRunAwayFromBattle:","; Run away from battle, with or without item","\tld a, [wBattleType]","\tcp BATTLETYPE_DEBUG","\tjp z, .can_escape","\tcp BATTLETYPE_CONTEST","\tjp z, .can_escape","\tcp BATTLETYPE_TRAP","\tjp z, .cant_escape","\tcp BATTLETYPE_CELEBI","\tjp z, .cant_escape","\tcp BATTLETYPE_SHINY","\tjp z, .cant_escape","\tcp BATTLETYPE_SUICUNE","\tjp z, .cant_escape","","\tld a, [wLinkMode]","\tand a","\tjp nz, .can_escape","","\tld a, [wBattleMode]","\tdec a","\tjp nz, .cant_run_from_trainer","","\tld a, [wEnemySubStatus5]","\tbit SUBSTATUS_CANT_RUN, a","\tjp nz, .cant_escape","","\tld a, [wPlayerWrapCount]","\tand a","\tjp nz, .cant_escape","","\tpush hl","\tpush de","\tld a, [wBattleMonItem]","\tld [wNamedObjectIndexBuffer], a","\tld b, a","\tcallfar GetItemHeldEffect","\tld a, b","\tcp HELD_ESCAPE","\tpop de","\tpop hl","\tjr nz, .no_flee_item","","\tcall SetPlayerTurn","\tcall GetItemName","\tld hl, BattleText_UserFledUsingAStringBuffer1","\tcall StdBattleTextbox","\tjp .can_escape","",".no_flee_item","\tld a, [wNumFleeAttempts]","\tinc a","\tld [wNumFleeAttempts], a","\tld a, [hli]","\tldh [hMultiplicand + 1], a","\tld a, [hl]","\tldh [hMultiplicand + 2], a","\tld a, [de]","\tinc de","\tldh [hEnemyMonSpeed + 0], a","\tld a, [de]","\tldh [hEnemyMonSpeed + 1], a","\tcall SafeLoadTempTilemapToTilemap","\tld de, hMultiplicand + 1","\tld hl, hEnemyMonSpeed","\tld c, 2","\tcall CompareBytes","\tjr nc, .can_escape","","\txor a","\tldh [hMultiplicand + 0], a","\tld a, 32","\tldh [hMultiplier], a","\tcall Multiply","\tldh a, [hProduct + 2]","\tldh [hDividend + 0], a","\tldh a, [hProduct + 3]","\tldh [hDividend + 1], a","\tldh a, [hEnemyMonSpeed + 0]","\tld b, a","\tldh a, [hEnemyMonSpeed + 1]","\tsrl b","\trr a","\tsrl b","\trr a","\tand a","\tjr z, .can_escape","\tldh [hDivisor], a","\tld b, 2","\tcall Divide","\tldh a, [hQuotient + 2]","\tand a","\tjr nz, .can_escape","\tld a, [wNumFleeAttempts]","\tld c, a",".loop","\tdec c","\tjr z, .cant_escape_2","\tld b, 30","\tldh a, [hQuotient + 3]","\tadd b","\tldh [hQuotient + 3], a","\tjr c, .can_escape","\tjr .loop","",".cant_escape_2","\tcall BattleRandom","\tld b, a","\tldh a, [hQuotient + 3]","\tcp b","\tjr nc, .can_escape","\tld a, BATTLEPLAYERACTION_USEITEM","\tld [wBattlePlayerAction], a","\tld hl, BattleText_CantEscape2","\tjr .print_inescapable_text","",".cant_escape","\tld hl, BattleText_CantEscape","\tjr .print_inescapable_text","",".cant_run_from_trainer","\tld hl, BattleText_TheresNoEscapeFromTrainerBattle","",".print_inescapable_text","\tcall StdBattleTextbox","\tld a, TRUE","\tld [wFailedToFlee], a","\tcall LoadTilemapToTempTilemap","\tand a","\tret","",".can_escape","\tld a, [wLinkMode]","\tand a","\tld a, DRAW","\tjr z, .fled","\tcall LoadTilemapToTempTilemap","\txor a ; BATTLEPLAYERACTION_USEMOVE","\tld [wBattlePlayerAction], a","\tld a, $f","\tld [wCurMoveNum], a","\txor a","\tld [wCurPlayerMove], a","\tcall LinkBattleSendReceiveAction","\tcall SafeLoadTempTilemapToTilemap","\tcall CheckMobileBattleError","\tjr c, .mobile","","\t; Got away safely","\tld a, [wBattleAction]","\tcp BATTLEACTION_FORFEIT","\tld a, DRAW","\tjr z, .fled","\tdec a ; LOSE",".fled","\tld b, a","\tld a, [wBattleResult]","\tand BATTLERESULT_BITMASK","\tadd b","\tld [wBattleResult], a","\tcall StopDangerSound","\tpush de","\tld de, SFX_RUN","\tcall WaitPlaySFX","\tpop de","\tcall WaitSFX","\tld hl, BattleText_GotAwaySafely","\tcall StdBattleTextbox","\tcall WaitSFX","\tcall LoadTilemapToTempTilemap","\tscf","\tret","",".mobile","\tcall StopDangerSound","\tld hl, wcd2a","\tbit 4, [hl]","\tjr nz, .skip_link_error","\tld hl, BattleText_LinkErrorBattleCanceled","\tcall StdBattleTextbox","",".skip_link_error","\tcall WaitSFX","\tcall LoadTilemapToTempTilemap","\tscf","\tret"],"name":"TryToRunAwayFromBattle","file":"engine/battle/core.asm","lineNo":3666,"address":137073,"addressUsedBy":[]}