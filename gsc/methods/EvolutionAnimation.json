{"names":["EvolutionAnimation"],"callingMethods":[],"methodsCalled":["ClearJoypad","DelayFrame","DelayFrames","FarCall","GetBaseData","GetPartyLocation","GetSGBLayout","InitSpriteAnimStruct","JoyTextDelay","PlayMonCry","PlayMusic","PlaySFX","Predef","PrepMonFrontpic","Request2bpp","WaitBGMap"],"methodAddressesUsed":["CheckFaintedFrzSlp","ClearSpriteAnims","PlaySpriteAnimations"],"varsSet":["hBGMapMode","rOBP0","wBaseDexNo","wBoxAlignment","wCurPartySpecies","wCurSpecies","wEvolutionCanceled","wEvolutionPicOffset","wJumptableIndex","wLowHealthAlarm","wPlayerHPPal"],"varsUsed":["hJoyDown","hVBlankCounter","rOBP0","wBaseDexNo","wBoxAlignment","wCurPartyMon","wCurPartySpecies","wCurSpecies","wEvolutionCanceled","wEvolutionNewSpecies","wEvolutionOldSpecies","wEvolutionPicOffset","wForceEvolution","wJumptableIndex","wPlayerHPPal"],"varAddressesUsed":["AnimateFrontpicPredef","GetAnimatedFrontpicPredef","vTiles0","vTiles2","wPartyMon1Species","wVirtualOAMSprite00Attributes"],"constantsUsed":["ANIM_MON_EVOLVE","FALSE","MUSIC_EVOLUTION","MUSIC_NONE","NUM_SPRITE_OAM_STRUCTS","SCGB_EVOLUTION","SCREEN_WIDTH","SFX_EVOLVED","SPRITEANIMSTRUCT_0C","SPRITEANIMSTRUCT_JUMPTABLE_INDEX","SPRITEANIMSTRUCT_TILE_ID","SPRITE_ANIM_INDEX_EVOLUTION_BALL_OF_LIGHT","TRUE","tile"],"lines":["EvolutionAnimation:","\tpush hl","\tpush de","\tpush bc","\tld a, [wCurSpecies]","\tpush af","\tldh a, [rOBP0]","\tpush af","\tld a, [wBaseDexNo]","\tpush af","","\tcall .EvolutionAnimation","","\tpop af","\tld [wBaseDexNo], a","\tpop af","\tldh [rOBP0], a","\tpop af","\tld [wCurSpecies], a","\tpop bc","\tpop de","\tpop hl","","\tld a, [wEvolutionCanceled]","\tand a","\tret z","","\tscf","\tret","",".EvolutionAnimation:","\tld a, %11100100","\tldh [rOBP0], a","","\tld de, MUSIC_NONE","\tcall PlayMusic","","\tfarcall ClearSpriteAnims","","\tld de, .GFX","\tld hl, vTiles0","\tlb bc, BANK(.GFX), 8","\tcall Request2bpp","","\txor a","\tld [wLowHealthAlarm], a","\tcall WaitBGMap","\txor a","\tldh [hBGMapMode], a","","\tld a, [wEvolutionOldSpecies]","\tld [wPlayerHPPal], a","","\tld c, FALSE","\tcall .GetSGBLayout","","\tld a, [wEvolutionOldSpecies]","\tld [wCurPartySpecies], a","\tld [wCurSpecies], a","\tcall .PlaceFrontpic","","\tld de, vTiles2","\tld hl, vTiles2 tile $31","\tld bc, 7 * 7","\tcall Request2bpp","","\tld a, 7 * 7","\tld [wEvolutionPicOffset], a","\tcall .ReplaceFrontpic","\tld a, [wEvolutionNewSpecies]","\tld [wCurPartySpecies], a","\tld [wCurSpecies], a","\tcall .LoadFrontpic","","\tld a, [wEvolutionOldSpecies]","\tld [wCurPartySpecies], a","\tld [wCurSpecies], a","","\tld a, 1","\tldh [hBGMapMode], a","","\tcall .check_statused","\tjr c, .skip_cry","\tld a, [wEvolutionOldSpecies]","\tcall PlayMonCry",".skip_cry","","\tld de, MUSIC_EVOLUTION","\tcall PlayMusic","","\tld c, 80","\tcall DelayFrames","","\tld c, TRUE","\tcall .GetSGBLayout","","\tcall .AnimationSequence","\tjr c, .cancel_evo","","\tld a, -7 * 7","\tld [wEvolutionPicOffset], a","\tcall .ReplaceFrontpic","","\txor a","\tld [wEvolutionCanceled], a","","\tld a, [wEvolutionNewSpecies]","\tld [wPlayerHPPal], a","","\tld c, FALSE","\tcall .GetSGBLayout","","\tcall .PlayEvolvedSFX","\tfarcall ClearSpriteAnims","\tcall .check_statused","\tjr c, .no_anim","","\tld a, [wBoxAlignment]","\tpush af","\tld a, $1","\tld [wBoxAlignment], a","\tld a, [wCurPartySpecies]","\tpush af","","\tld a, [wPlayerHPPal]","\tld [wCurPartySpecies], a","\thlcoord 7, 2","\tld d, $0","\tld e, ANIM_MON_EVOLVE","\tpredef AnimateFrontpic","","\tpop af","\tld [wCurPartySpecies], a","\tpop af","\tld [wBoxAlignment], a","\tret","",".no_anim","\tret","",".cancel_evo","\tld a, TRUE","\tld [wEvolutionCanceled], a","","\tld a, [wEvolutionOldSpecies]","\tld [wPlayerHPPal], a","","\tld c, FALSE","\tcall .GetSGBLayout","","\tcall .PlayEvolvedSFX","\tfarcall ClearSpriteAnims","\tcall .check_statused","\tret c","","\tld a, [wPlayerHPPal]","\tcall PlayMonCry","\tret","",".GetSGBLayout:","\tld b, SCGB_EVOLUTION","\tjp GetSGBLayout","",".PlaceFrontpic:","\tcall GetBaseData","\thlcoord 7, 2","\tjp PrepMonFrontpic","",".LoadFrontpic:","\tcall GetBaseData","\tld a, $1","\tld [wBoxAlignment], a","\tld de, vTiles2","\tpredef GetAnimatedFrontpic","\txor a","\tld [wBoxAlignment], a","\tret","",".AnimationSequence:","\tcall ClearJoypad","\tlb bc, 1, 2 * 7 ; flash b times, wait c frames in between",".loop","\tpush bc","\tcall .WaitFrames_CheckPressedB","\tpop bc","\tjr c, .exit_sequence","\tpush bc","\tcall .Flash","\tpop bc","\tinc b","\tdec c","\tdec c","\tjr nz, .loop","\tand a","\tret","",".exit_sequence","\tscf","\tret","",".Flash:","\tld a, -7 * 7 ; new stage","\tld [wEvolutionPicOffset], a","\tcall .ReplaceFrontpic","\tld a, 7 * 7 ; previous stage","\tld [wEvolutionPicOffset], a","\tcall .ReplaceFrontpic","\tdec b","\tjr nz, .Flash","\tret","",".ReplaceFrontpic:","\tpush bc","\txor a","\tldh [hBGMapMode], a","\thlcoord 7, 2","\tlb bc, 7, 7","\tld de, SCREEN_WIDTH - 7",".loop1","\tpush bc",".loop2","\tld a, [wEvolutionPicOffset]","\tadd [hl]","\tld [hli], a","\tdec c","\tjr nz, .loop2","\tpop bc","\tadd hl, de","\tdec b","\tjr nz, .loop1","\tld a, $1","\tldh [hBGMapMode], a","\tcall WaitBGMap","\tpop bc","\tret","",".WaitFrames_CheckPressedB:","\tcall DelayFrame","\tpush bc","\tcall JoyTextDelay","\tldh a, [hJoyDown]","\tpop bc","\tand B_BUTTON","\tjr nz, .pressed_b",".loop3","\tdec c","\tjr nz, .WaitFrames_CheckPressedB","\tand a","\tret","",".pressed_b","\tld a, [wForceEvolution]","\tand a","\tjr nz, .loop3","\tscf","\tret","",".check_statused","\tld a, [wCurPartyMon]","\tld hl, wPartyMon1Species","\tcall GetPartyLocation","\tld b, h","\tld c, l","\tfarcall CheckFaintedFrzSlp","\tret","",".PlayEvolvedSFX:","\tld a, [wEvolutionCanceled]","\tand a","\tret nz","\tld de, SFX_EVOLVED","\tcall PlaySFX","\tld hl, wJumptableIndex","\tld a, [hl]","\tpush af","\tld [hl], $0",".loop4","\tcall .balls_of_light","\tjr nc, .done","\tcall .AnimateBallsOfLight","\tjr .loop4","",".done","\tld c, 32",".loop5","\tcall .AnimateBallsOfLight","\tdec c","\tjr nz, .loop5","\tpop af","\tld [wJumptableIndex], a","\tret","",".balls_of_light","\tld hl, wJumptableIndex","\tld a, [hl]","\tcp 32","\tret nc","\tld d, a","\tinc [hl]","\tand $1","\tjr nz, .done_balls","\tld e, $0","\tcall .GenerateBallOfLight","\tld e, $10","\tcall .GenerateBallOfLight","",".done_balls","\tscf","\tret","",".GenerateBallOfLight:","\tpush de","\tdepixel 9, 11","\tld a, SPRITE_ANIM_INDEX_EVOLUTION_BALL_OF_LIGHT","\tcall InitSpriteAnimStruct","\tld hl, SPRITEANIMSTRUCT_JUMPTABLE_INDEX","\tadd hl, bc","\tld a, [wJumptableIndex]","\tand %1110","\tsla a","\tpop de","\tadd e","\tld [hl], a","\tld hl, SPRITEANIMSTRUCT_TILE_ID","\tadd hl, bc","\tld [hl], $0","\tld hl, SPRITEANIMSTRUCT_0C","\tadd hl, bc","\tld [hl], $10","\tret","",".AnimateBallsOfLight:","\tpush bc","\tcallfar PlaySpriteAnimations","\t; a \u003d (([hVBlankCounter] + 4) / 2) % NUM_PALETTES","\tldh a, [hVBlankCounter]","\tand %1110","\tsrl a","\tinc a","\tinc a","\tand $7","\tld b, a","\tld hl, wVirtualOAMSprite00Attributes","\tld c, NUM_SPRITE_OAM_STRUCTS",".loop6","\tld a, [hl]","\tor b","\tld [hli], a ; attributes","rept SPRITEOAMSTRUCT_LENGTH - 1","\tinc hl","endr","\tdec c","\tjr nz, .loop6","\tpop bc","\tcall DelayFrame","\tret","",".GFX:","INCBIN \"gfx/evo/bubble_large.2bpp\"","INCBIN \"gfx/evo/bubble.2bpp\""],"name":"EvolutionAnimation","file":"engine/movie/evolution_animation.asm","lineNo":1,"address":158743,"addressUsedBy":["EvolveAfterBattle_MasterLoop"]}