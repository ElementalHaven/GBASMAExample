{"names":["SapHealth"],"callingMethods":["BattleCommand_DrainTarget","BattleCommand_EatDream"],"methodsCalled":["Predef","RefreshBattleHuds","UpdateBattleMonInParty"],"methodAddressesUsed":[],"varsSet":["hDividend","wBuffer5","wBuffer6","wWhichHPBar"],"varsUsed":["hBattleTurn","hDividend"],"varAddressesUsed":["AnimateHPBarPredef","wBattleMonHP","wBattleMonMaxHP","wBuffer4","wCurDamage","wEnemyMonHP","wEnemyMonMaxHP"],"constantsUsed":[],"lines":["SapHealth:","\t; Divide damage by 2, store it in hDividend","\tld hl, wCurDamage","\tld a, [hli]","\tsrl a","\tldh [hDividend], a","\tld b, a","\tld a, [hl]","\trr a","\tldh [hDividend + 1], a","\tor b","\tjr nz, .at_least_one","\tld a, 1","\tldh [hDividend + 1], a",".at_least_one","","\tld hl, wBattleMonHP","\tld de, wBattleMonMaxHP","\tldh a, [hBattleTurn]","\tand a","\tjr z, .battlemonhp","\tld hl, wEnemyMonHP","\tld de, wEnemyMonMaxHP",".battlemonhp","","\t; Store current HP in little endian wBuffer3/4","\tld bc, wBuffer4","\tld a, [hli]","\tld [bc], a","\tld a, [hl]","\tdec bc","\tld [bc], a","","\t; Store max HP in little endian wBuffer1/2","\tld a, [de]","\tdec bc","\tld [bc], a","\tinc de","\tld a, [de]","\tdec bc","\tld [bc], a","","\t; Add hDividend to current HP and copy it to little endian wBuffer5/6","\tldh a, [hDividend + 1]","\tld b, [hl]","\tadd b","\tld [hld], a","\tld [wBuffer5], a","\tldh a, [hDividend]","\tld b, [hl]","\tadc b","\tld [hli], a","\tld [wBuffer6], a","\tjr c, .max_hp","","\t; Substract current HP from max HP (to see if we have more than max HP)","\tld a, [hld]","\tld b, a","\tld a, [de]","\tdec de","\tsub b","\tld a, [hli]","\tld b, a","\tld a, [de]","\tinc de","\tsbc b","\tjr nc, .finish","",".max_hp","\t; Load max HP into current HP and copy it to little endian wBuffer5/6","\tld a, [de]","\tld [hld], a","\tld [wBuffer5], a","\tdec de","\tld a, [de]","\tld [hli], a","\tld [wBuffer6], a","\tinc de","",".finish","\tldh a, [hBattleTurn]","\tand a","\thlcoord 10, 9","\tld a, $1","\tjr z, .hp_bar","\thlcoord 2, 2","\txor a",".hp_bar","\tld [wWhichHPBar], a","\tpredef AnimateHPBar","\tcall RefreshBattleHuds","\tjp UpdateBattleMonInParty"],"name":"SapHealth","file":"engine/battle/effect_commands.asm","lineNo":3870,"address":120544,"addressUsedBy":[]}