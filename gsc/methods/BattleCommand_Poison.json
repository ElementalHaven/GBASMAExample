{"names":["BattleCommand_Poison"],"callingMethods":[],"methodsCalled":["AnimateCurrentMove","AnimateFailedMove","BattleRandom","CheckIfTargetIsPoisonType","CheckSubstituteOpp","FarCall","GetBattleVar","GetBattleVarAddr","GetItemName","GetOpponentItem","PoisonOpponent","RefreshBattleHuds","StdBattleTextbox"],"methodAddressesUsed":["UseHeldStatusHealingItem"],"varsSet":["wNamedObjectIndexBuffer"],"varsUsed":["hBattleTurn","wAttackMissed","wInBattleTowerBattle","wLinkMode","wPlayerSubStatus5","wTypeModifier"],"varAddressesUsed":["ProtectedByText","wEnemyToxicCount","wPlayerToxicCount"],"constantsUsed":["BATTLE_VARS_MOVE_EFFECT","BATTLE_VARS_STATUS_OPP","BATTLE_VARS_SUBSTATUS5_OPP"],"lines":["BattleCommand_Poison:","; poison","","\tld hl, DoesntAffectText","\tld a, [wTypeModifier]","\tand $7f","\tjp z, .failed","","\tcall CheckIfTargetIsPoisonType","\tjp z, .failed","","\tld a, BATTLE_VARS_STATUS_OPP","\tcall GetBattleVar","\tld b, a","\tld hl, AlreadyPoisonedText","\tand 1 \u003c\u003c PSN","\tjp nz, .failed","","\tcall GetOpponentItem","\tld a, b","\tcp HELD_PREVENT_POISON","\tjr nz, .do_poison","\tld a, [hl]","\tld [wNamedObjectIndexBuffer], a","\tcall GetItemName","\tld hl, ProtectedByText","\tjr .failed","",".do_poison","\tld hl, DidntAffect1Text","\tld a, BATTLE_VARS_STATUS_OPP","\tcall GetBattleVar","\tand a","\tjr nz, .failed","","\tldh a, [hBattleTurn]","\tand a","\tjr z, .dont_sample_failure","","\tld a, [wLinkMode]","\tand a","\tjr nz, .dont_sample_failure","","\tld a, [wInBattleTowerBattle]","\tand a","\tjr nz, .dont_sample_failure","","\tld a, [wPlayerSubStatus5]","\tbit SUBSTATUS_LOCK_ON, a","\tjr nz, .dont_sample_failure","","\tcall BattleRandom","\tcp 25 percent + 1 ; 25% chance AI fails","\tjr c, .failed","",".dont_sample_failure","\tcall CheckSubstituteOpp","\tjr nz, .failed","\tld a, [wAttackMissed]","\tand a","\tjr nz, .failed","\tcall .check_toxic","\tjr z, .toxic","","\tcall .apply_poison","\tld hl, WasPoisonedText","\tcall StdBattleTextbox","\tjr .finished","",".toxic","\tset SUBSTATUS_TOXIC, [hl]","\txor a","\tld [de], a","\tcall .apply_poison","","\tld hl, BadlyPoisonedText","\tcall StdBattleTextbox","",".finished","\tfarcall UseHeldStatusHealingItem","\tret","",".failed","\tpush hl","\tcall AnimateFailedMove","\tpop hl","\tjp StdBattleTextbox","",".apply_poison","\tcall AnimateCurrentMove","\tcall PoisonOpponent","\tjp RefreshBattleHuds","",".check_toxic","\tld a, BATTLE_VARS_SUBSTATUS5_OPP","\tcall GetBattleVarAddr","\tldh a, [hBattleTurn]","\tand a","\tld de, wEnemyToxicCount","\tjr z, .ok","\tld de, wPlayerToxicCount",".ok","\tld a, BATTLE_VARS_MOVE_EFFECT","\tcall GetBattleVar","\tcp EFFECT_TOXIC","\tret"],"name":"BattleCommand_Poison","file":"engine/battle/effect_commands.asm","lineNo":3730,"address":120442,"addressUsedBy":[]}