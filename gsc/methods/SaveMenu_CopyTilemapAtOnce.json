{"names":["SaveMenu_CopyTilemapAtOnce"],"callingMethods":[],"methodsCalled":["WaitBGMap"],"methodAddressesUsed":[],"varsSet":["hBGMapMode","hMapAnims","hSPBuffer","hTilesPerCycle","rVBK"],"varsUsed":["hBGMapAddress","hBGMapMode","hCGB","hMapAnims","hSPBuffer","hTilesPerCycle","rLY"],"varAddressesUsed":["vBGMap0","vBGMap2"],"constantsUsed":["BG_MAP_WIDTH","SCREEN_HEIGHT","SCREEN_WIDTH","rSTAT"],"lines":["SaveMenu_CopyTilemapAtOnce:","\tldh a, [hCGB]","\tand a","\tjp z, WaitBGMap","","; The following is a modified version of _CopyTilemapAtOnce","; that waits for [rLY] to be $60 instead of $80 - 1.","\tldh a, [hBGMapMode]","\tpush af","\txor a","\tldh [hBGMapMode], a","","\tldh a, [hMapAnims]","\tpush af","\txor a","\tldh [hMapAnims], a","",".wait","\tldh a, [rLY]","\tcp $60","\tjr c, .wait","","\tdi","\tld a, BANK(vBGMap2)","\tldh [rVBK], a","\thlcoord 0, 0, wAttrmap","\tcall .CopyBGMapViaStack","\tld a, BANK(vBGMap0)","\tldh [rVBK], a","\thlcoord 0, 0","\tcall .CopyBGMapViaStack","",".wait2","\tldh a, [rLY]","\tcp $60","\tjr c, .wait2","\tei","","\tpop af","\tldh [hMapAnims], a","\tpop af","\tldh [hBGMapMode], a","\tret","",".CopyBGMapViaStack:","; Copy all tiles to vBGMap","\tld [hSPBuffer], sp","\tld sp, hl","\tldh a, [hBGMapAddress + 1]","\tld h, a","\tld l, 0","\tld a, SCREEN_HEIGHT","\tldh [hTilesPerCycle], a","\tld b, 1 \u003c\u003c 1 ; not in v/hblank","\tld c, LOW(rSTAT)","",".loop","rept SCREEN_WIDTH / 2","\tpop de","; if in v/hblank, wait until not in v/hblank",".loop\\@","\tldh a, [c]","\tand b","\tjr nz, .loop\\@","; load vBGMap","\tld [hl], e","\tinc l","\tld [hl], d","\tinc l","endr","","\tld de, BG_MAP_WIDTH - SCREEN_WIDTH","\tadd hl, de","\tldh a, [hTilesPerCycle]","\tdec a","\tldh [hTilesPerCycle], a","\tjr nz, .loop","","\tldh a, [hSPBuffer]","\tld l, a","\tldh a, [hSPBuffer + 1]","\tld h, a","\tld sp, hl","\tret"],"name":"SaveMenu_CopyTilemapAtOnce","file":"engine/menus/savemenu_copytilemapatonce.asm","lineNo":1,"address":155899,"addressUsedBy":["SaveMenu"]}