{"names":["ResidualDamage"],"callingMethods":["Battle_EnemyFirst","Battle_PlayerFirst"],"methodsCalled":["Call_PlayBattleAnim_OnlyIfVisible","DelayFrames","GetBattleVar","GetBattleVarAddr","GetEighthMaxHP","GetQuarterMaxHP","GetSixteenthMaxHP","HasUserFainted","RefreshBattleHuds","RestoreHP","StdBattleTextbox","SubtractHPFromUser","SwitchTurnCore"],"methodAddressesUsed":[],"varsSet":["hBGMapMode","wNumHits"],"varsUsed":["hBattleTurn"],"varAddressesUsed":["wBattleMonHP","wEnemyMonHP","wEnemyToxicCount","wPlayerToxicCount"],"constantsUsed":["ANIM_BRN","ANIM_IN_NIGHTMARE","ANIM_PSN","ANIM_SAP","BATTLE_VARS_STATUS","BATTLE_VARS_SUBSTATUS1","BATTLE_VARS_SUBSTATUS3_OPP","BATTLE_VARS_SUBSTATUS4","BATTLE_VARS_SUBSTATUS5"],"lines":["ResidualDamage:","; Return z if the user fainted before","; or as a result of residual damage.","; For Sandstorm damage, see HandleWeather.","","\tcall HasUserFainted","\tret z","","\tld a, BATTLE_VARS_STATUS","\tcall GetBattleVar","\tand 1 \u003c\u003c PSN | 1 \u003c\u003c BRN","\tjr z, .did_psn_brn","","\tld hl, HurtByPoisonText","\tld de, ANIM_PSN","\tand 1 \u003c\u003c BRN","\tjr z, .got_anim","\tld hl, HurtByBurnText","\tld de, ANIM_BRN",".got_anim","","\tpush de","\tcall StdBattleTextbox","\tpop de","","\txor a","\tld [wNumHits], a","\tcall Call_PlayBattleAnim_OnlyIfVisible","\tcall GetEighthMaxHP","\tld de, wPlayerToxicCount","\tldh a, [hBattleTurn]","\tand a","\tjr z, .check_toxic","\tld de, wEnemyToxicCount",".check_toxic","","\tld a, BATTLE_VARS_SUBSTATUS5","\tcall GetBattleVar","\tbit SUBSTATUS_TOXIC, a","\tjr z, .did_toxic","\tcall GetSixteenthMaxHP","\tld a, [de]","\tinc a","\tld [de], a","\tld hl, 0",".add","\tadd hl, bc","\tdec a","\tjr nz, .add","\tld b, h","\tld c, l",".did_toxic","","\tcall SubtractHPFromUser",".did_psn_brn","","\tcall HasUserFainted","\tjp z, .fainted","","\tld a, BATTLE_VARS_SUBSTATUS4","\tcall GetBattleVarAddr","\tbit SUBSTATUS_LEECH_SEED, [hl]","\tjr z, .not_seeded","","\tcall SwitchTurnCore","\txor a","\tld [wNumHits], a","\tld de, ANIM_SAP","\tld a, BATTLE_VARS_SUBSTATUS3_OPP","\tcall GetBattleVar","\tand 1 \u003c\u003c SUBSTATUS_FLYING | 1 \u003c\u003c SUBSTATUS_UNDERGROUND","\tcall z, Call_PlayBattleAnim_OnlyIfVisible","\tcall SwitchTurnCore","","\tcall GetEighthMaxHP","\tcall SubtractHPFromUser","\tld a, $1","\tldh [hBGMapMode], a","\tcall RestoreHP","\tld hl, LeechSeedSapsText","\tcall StdBattleTextbox",".not_seeded","","\tcall HasUserFainted","\tjr z, .fainted","","\tld a, BATTLE_VARS_SUBSTATUS1","\tcall GetBattleVarAddr","\tbit SUBSTATUS_NIGHTMARE, [hl]","\tjr z, .not_nightmare","\txor a","\tld [wNumHits], a","\tld de, ANIM_IN_NIGHTMARE","\tcall Call_PlayBattleAnim_OnlyIfVisible","\tcall GetQuarterMaxHP","\tcall SubtractHPFromUser","\tld hl, HasANightmareText","\tcall StdBattleTextbox",".not_nightmare","","\tcall HasUserFainted","\tjr z, .fainted","","\tld a, BATTLE_VARS_SUBSTATUS1","\tcall GetBattleVarAddr","\tbit SUBSTATUS_CURSE, [hl]","\tjr z, .not_cursed","","\txor a","\tld [wNumHits], a","\tld de, ANIM_IN_NIGHTMARE","\tcall Call_PlayBattleAnim_OnlyIfVisible","\tcall GetQuarterMaxHP","\tcall SubtractHPFromUser","\tld hl, HurtByCurseText","\tcall StdBattleTextbox","",".not_cursed","\tld hl, wBattleMonHP","\tldh a, [hBattleTurn]","\tand a","\tjr z, .check_fainted","\tld hl, wEnemyMonHP","",".check_fainted","\tld a, [hli]","\tor [hl]","\tret nz","",".fainted","\tcall RefreshBattleHuds","\tld c, 20","\tcall DelayFrames","\txor a","\tret"],"name":"ResidualDamage","file":"engine/battle/core.asm","lineNo":1000,"address":134905,"addressUsedBy":[]}