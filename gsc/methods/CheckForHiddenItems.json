{"names":["CheckForHiddenItems"],"callingMethods":[],"methodsCalled":["EventFlagAction","GetFarByte","GetFarHalfword","GetMapScriptsBank"],"methodAddressesUsed":[],"varsSet":["wBuffer1","wBuffer2","wBuffer3","wBuffer4"],"varsUsed":["wBuffer1","wBuffer2","wBuffer3","wBuffer4","wCurMapBGEventCount","wXCoord","wYCoord"],"varAddressesUsed":["wCurMapBGEventsPointer"],"constantsUsed":["BG_EVENT_SIZE","CHECK_FLAG"],"lines":["CheckForHiddenItems:","; Checks to see if there are hidden items on the screen that have not yet been found.  If it finds one, returns carry.","\tcall GetMapScriptsBank","\tld [wBuffer1], a","; Get the coordinate of the bottom right corner of the screen, and load it in wBuffer3/wBuffer4.","\tld a, [wXCoord]","\tadd SCREEN_WIDTH / 4","\tld [wBuffer4], a","\tld a, [wYCoord]","\tadd SCREEN_HEIGHT / 4","\tld [wBuffer3], a","; Get the pointer for the first bg_event in the map...","\tld hl, wCurMapBGEventsPointer","\tld a, [hli]","\tld h, [hl]","\tld l, a","; ... before even checking to see if there are any BG events on this map.","\tld a, [wCurMapBGEventCount]","\tand a","\tjr z, .nobgeventitems","; For i \u003d 1:wCurMapBGEventCount...",".loop","; Store the counter in wBuffer2, and store the bg_event pointer in the stack.","\tld [wBuffer2], a","\tpush hl","; Get the Y coordinate of the BG event.","\tcall .GetFarByte","\tld e, a","; Is the Y coordinate of the BG event on the screen?  If not, go to the next BG event.","\tld a, [wBuffer3]","\tsub e","\tjr c, .next","\tcp SCREEN_HEIGHT / 2","\tjr nc, .next","; Is the X coordinate of the BG event on the screen?  If not, go to the next BG event.","\tcall .GetFarByte","\tld d, a","\tld a, [wBuffer4]","\tsub d","\tjr c, .next","\tcp SCREEN_WIDTH / 2","\tjr nc, .next","; Is this BG event a hidden item?  If not, go to the next BG event.","\tcall .GetFarByte","\tcp BGEVENT_ITEM","\tjr nz, .next","; Has this item already been found?  If not, set off the Itemfinder.","\tld a, [wBuffer1]","\tcall GetFarHalfword","\tld a, [wBuffer1]","\tcall GetFarHalfword","\tld d, h","\tld e, l","\tld b, CHECK_FLAG","\tcall EventFlagAction","\tld a, c","\tand a","\tjr z, .itemnearby","",".next","; Restore the bg_event pointer and increment it by the length of a bg_event.","\tpop hl","\tld bc, BG_EVENT_SIZE","\tadd hl, bc","; Restore the BG event counter and decrement it.  If it hits zero, there are no hidden items in range.","\tld a, [wBuffer2]","\tdec a","\tjr nz, .loop","",".nobgeventitems","\txor a","\tret","",".itemnearby","\tpop hl","\tscf","\tret","",".GetFarByte:","\tld a, [wBuffer1]","\tcall GetFarByte","\tinc hl","\tret"],"name":"CheckForHiddenItems","file":"engine/events/checkforhiddenitems.asm","lineNo":1,"address":196666,"addressUsedBy":["ItemFinder"]}