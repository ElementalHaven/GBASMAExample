{"names":["AnimateExpBar"],"callingMethods":["GiveExperiencePoints"],"methodsCalled":["CalcExpBar","CopyBytes","DelayFrames","FarCall","PlaceExpBar","PlaySFX","Predef","PrintPlayerHUD","StdBattleTextbox","TerminateExpBarSound","WaitSFX"],"methodAddressesUsed":["AnimateEndOfExpBar","CalcExpAtLevel","CalcLevel"],"varsSet":["hBGMapMode","hProduct","wBattleMonLevel","wCurPartyLevel","wMonType","wTempMonLevel","wd002","wd003","wd004"],"varsUsed":["hProduct","wBattleMonLevel","wCurBattleMon","wTempMonLevel","wd003","wd004"],"varAddressesUsed":["BattleText_StringBuffer1GrewToLevel","CopyMonToTempMonPredef","wBattleMonNick","wCurPartyMon","wStringBuffer1","wTempMonExp"],"constantsUsed":["MAX_LEVEL","MON_NAME_LENGTH","SFX_EXP_BAR","SFX_HIT_END_OF_EXP_BAR"],"lines":["AnimateExpBar:","\tpush bc","","\tld hl, wCurPartyMon","\tld a, [wCurBattleMon]","\tcp [hl]","\tjp nz, .finish","","\tld a, [wBattleMonLevel]","\tcp MAX_LEVEL","\tjp nc, .finish","","\tldh a, [hProduct + 3]","\tld [wd004], a","\tpush af","\tldh a, [hProduct + 2]","\tld [wd003], a","\tpush af","\txor a","\tld [wd002], a","\txor a ; PARTYMON","\tld [wMonType], a","\tpredef CopyMonToTempMon","\tld a, [wTempMonLevel]","\tld b, a","\tld e, a","\tpush de","\tld de, wTempMonExp + 2","\tcall CalcExpBar","\tpush bc","\tld hl, wTempMonExp + 2","\tld a, [wd004]","\tadd [hl]","\tld [hld], a","\tld a, [wd003]","\tadc [hl]","\tld [hld], a","\tjr nc, .NoOverflow","\tinc [hl]","\tjr nz, .NoOverflow","\tld a, $ff","\tld [hli], a","\tld [hli], a","\tld [hl], a","",".NoOverflow:","\tld d, MAX_LEVEL","\tcallfar CalcExpAtLevel","\tldh a, [hProduct + 1]","\tld b, a","\tldh a, [hProduct + 2]","\tld c, a","\tldh a, [hProduct + 3]","\tld d, a","\tld hl, wTempMonExp + 2","\tld a, [hld]","\tsub d","\tld a, [hld]","\tsbc c","\tld a, [hl]","\tsbc b","\tjr c, .AlreadyAtMaxExp","\tld a, b","\tld [hli], a","\tld a, c","\tld [hli], a","\tld a, d","\tld [hld], a","",".AlreadyAtMaxExp:","\tcallfar CalcLevel","\tld a, d","\tpop bc","\tpop de","\tld d, a","\tcp e","\tjr nc, .LoopLevels","\tld a, e","\tld d, a","",".LoopLevels:","\tld a, e","\tcp MAX_LEVEL","\tjr nc, .FinishExpBar","\tcp d","\tjr z, .FinishExpBar","\tinc a","\tld [wTempMonLevel], a","\tld [wCurPartyLevel], a","\tld [wBattleMonLevel], a","\tpush de","\tcall .PlayExpBarSound","\tld c, $40","\tcall .LoopBarAnimation","\tcall PrintPlayerHUD","\tld hl, wBattleMonNick","\tld de, wStringBuffer1","\tld bc, MON_NAME_LENGTH","\tcall CopyBytes","\tcall TerminateExpBarSound","\tld de, SFX_HIT_END_OF_EXP_BAR","\tcall PlaySFX","\tfarcall AnimateEndOfExpBar","\tcall WaitSFX","\tld hl, BattleText_StringBuffer1GrewToLevel","\tcall StdBattleTextbox","\tpop de","\tinc e","\tld b, $0","\tjr .LoopLevels","",".FinishExpBar:","\tpush bc","\tld b, d","\tld de, wTempMonExp + 2","\tcall CalcExpBar","\tld a, b","\tpop bc","\tld c, a","\tcall .PlayExpBarSound","\tcall .LoopBarAnimation","\tcall TerminateExpBarSound","\tpop af","\tldh [hProduct + 2], a","\tpop af","\tldh [hProduct + 3], a","",".finish","\tpop bc","\tret","",".PlayExpBarSound:","\tpush bc","\tcall WaitSFX","\tld de, SFX_EXP_BAR","\tcall PlaySFX","\tld c, 10","\tcall DelayFrames","\tpop bc","\tret","",".LoopBarAnimation:","\tld d, 3","\tdec b",".anim_loop","\tinc b","\tpush bc","\tpush de","\thlcoord 17, 11","\tcall PlaceExpBar","\tpop de","\tld a, $1","\tldh [hBGMapMode], a","\tld c, d","\tcall DelayFrames","\txor a","\tldh [hBGMapMode], a","\tpop bc","\tld a, c","\tcp b","\tjr z, .end_animation","\tinc b","\tpush bc","\tpush de","\thlcoord 17, 11","\tcall PlaceExpBar","\tpop de","\tld a, $1","\tldh [hBGMapMode], a","\tld c, d","\tcall DelayFrames","\txor a","\tldh [hBGMapMode], a","\tdec d","\tjr nz, .min_number_of_frames","\tld d, 1",".min_number_of_frames","\tpop bc","\tld a, c","\tcp b","\tjr nz, .anim_loop",".end_animation","\tld a, $1","\tldh [hBGMapMode], a","\tret"],"name":"AnimateExpBar","file":"engine/battle/core.asm","lineNo":7426,"address":140124,"addressUsedBy":[]}