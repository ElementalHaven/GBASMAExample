{"names":["_ComposeMailMessage"],"callingMethods":[],"methodsCalled":["ByteFill","ClearBGPalettes","ClearBox","ClearSprites","DelayFrame","DisableLCD","DmgToCgbBGPals","DmgToCgbObjPal0","FarCall","FarCopyBytes","GetSGBLayout","InitSpriteAnimStruct","JoyTextDelay","LoadNamingScreenGFX","MailComposition_TryAddLastCharacter","NamingScreen_DeleteCharacter","NamingScreen_GetLastCharacter","NamingScreen_GetTextCursorPosition","NamingScreen_InitNameEntry","NamingScreen_PressedA_GetCursorCommand","NamingScreen_StoreEntry","PlaceString","WaitBGMap","WaitTop"],"methodAddressesUsed":["ClearSpriteAnims","PlaySpriteAnimationsAndDelayFrame"],"varsSet":["hBGMapMode","hInMenu","hMapAnims","hSCX","hSCY","rLCDC","wNamingScreenCursorObjectPointer","wNamingScreenMaxNameLength"],"varsUsed":["hInMenu","hMapAnims","wJumptableIndex"],"varAddressesUsed":["MailEntry_Lowercase","MailEntry_Uppercase","hJoyPressed","vTiles0","wNamingScreenCurNameLength","wNamingScreenCursorObjectPointer","wNamingScreenDestinationPointer","wSpriteAnimDict"],"constantsUsed":["LCDC_DEFAULT","MAIL_LINE_LENGTH","MAIL_MSG_LENGTH","NAMINGSCREEN_BORDER","NAMINGSCREEN_UNDERLINE","SCGB_DIPLOMA","SCREEN_WIDTH","SPRITEANIMSTRUCT_0C","SPRITEANIMSTRUCT_0D","SPRITEANIMSTRUCT_0E","SPRITEANIMSTRUCT_ANIM_SEQ_ID","SPRITEANIMSTRUCT_FRAMESET_ID","SPRITE_ANIM_INDEX_COMPOSE_MAIL_CURSOR","SPRITE_ANIM_INDEX_PARTY_MON","tile","tiles"],"lines":["_ComposeMailMessage:","\tld hl, wNamingScreenDestinationPointer","\tld [hl], e","\tinc hl","\tld [hl], d","\tldh a, [hMapAnims]","\tpush af","\txor a","\tldh [hMapAnims], a","\tldh a, [hInMenu]","\tpush af","\tld a, $1","\tldh [hInMenu], a","\tcall .InitBlankMail","\tcall DelayFrame","",".loop","\tcall .DoMailEntry","\tjr nc, .loop","","\tpop af","\tldh [hInMenu], a","\tpop af","\tldh [hMapAnims], a","\tret","",".InitBlankMail:","\tcall ClearBGPalettes","\tcall DisableLCD","\tcall LoadNamingScreenGFX","\tld de, vTiles0 tile $00","\tld hl, .MailIcon","\tld bc, 8 tiles","\tld a, BANK(.MailIcon)","\tcall FarCopyBytes","\txor a","\tld hl, wSpriteAnimDict","\tld [hli], a","\tld [hl], a","","\t; init mail icon","\tdepixel 3, 2","\tld a, SPRITE_ANIM_INDEX_PARTY_MON","\tcall InitSpriteAnimStruct","","\tld hl, SPRITEANIMSTRUCT_ANIM_SEQ_ID","\tadd hl, bc","\tld [hl], $0","\tcall .InitCharset","\tld a, LCDC_DEFAULT","\tldh [rLCDC], a","\tcall .initwNamingScreenMaxNameLength","\tld b, SCGB_DIPLOMA","\tcall GetSGBLayout","\tcall WaitBGMap","\tcall WaitTop","\tld a, %11100100","\tcall DmgToCgbBGPals","\tld a, %11100100","\tcall DmgToCgbObjPal0","\tcall NamingScreen_InitNameEntry","\tld hl, wNamingScreenDestinationPointer","\tld e, [hl]","\tinc hl","\tld d, [hl]","\tld hl, MAIL_LINE_LENGTH","\tadd hl, de","\tld [hl], \"\u003cNEXT\u003e\"","\tret","",".MailIcon:","INCBIN \"gfx/icons/mail_big.2bpp\"","",".initwNamingScreenMaxNameLength","\tld a, MAIL_MSG_LENGTH + 1","\tld [wNamingScreenMaxNameLength], a","\tret","",".PleaseWriteAMailString: ; unreferenced","\tdb \"メールを　かいてね@\"","",".InitCharset:","\tcall WaitTop","\thlcoord 0, 0","\tld bc, 6 * SCREEN_WIDTH","\tld a, NAMINGSCREEN_BORDER","\tcall ByteFill","\thlcoord 0, 6","\tld bc, 12 * SCREEN_WIDTH","\tld a, \" \"","\tcall ByteFill","\thlcoord 1, 1","\tlb bc, 4, SCREEN_WIDTH - 2","\tcall ClearBox","\tld de, MailEntry_Uppercase","",".PlaceMailCharset:","\thlcoord 1, 7","\tld b, 6",".next","\tld c, SCREEN_WIDTH - 1",".loop_","\tld a, [de]","\tld [hli], a","\tinc de","\tdec c","\tjr nz, .loop_","\tpush de","\tld de, SCREEN_WIDTH + 1","\tadd hl, de","\tpop de","\tdec b","\tjr nz, .next","\tret","",".DoMailEntry:","\tcall JoyTextDelay","\tld a, [wJumptableIndex]","\tbit 7, a","\tjr nz, .exit_mail","\tcall .DoJumptable","\tfarcall PlaySpriteAnimationsAndDelayFrame","\tcall .Update","\tcall DelayFrame","\tand a","\tret","",".exit_mail","\tcallfar ClearSpriteAnims","\tcall ClearSprites","\txor a","\tldh [hSCX], a","\tldh [hSCY], a","\tscf","\tret","",".Update:","\txor a","\tldh [hBGMapMode], a","\thlcoord 1, 1","\tlb bc, 4, 18","\tcall ClearBox","\tld hl, wNamingScreenDestinationPointer","\tld e, [hl]","\tinc hl","\tld d, [hl]","\thlcoord 2, 2","\tcall PlaceString","\tld a, $1","\tldh [hBGMapMode], a","\tret","",".DoJumptable:","\tld a, [wJumptableIndex]","\tld e, a","\tld d, 0","\tld hl, .Jumptable","\tadd hl, de","\tadd hl, de","\tld a, [hli]","\tld h, [hl]","\tld l, a","\tjp hl","",".Jumptable:","\tdw .init_blinking_cursor","\tdw .process_joypad","",".init_blinking_cursor","\tdepixel 9, 2","\tld a, SPRITE_ANIM_INDEX_COMPOSE_MAIL_CURSOR","\tcall InitSpriteAnimStruct","\tld a, c","\tld [wNamingScreenCursorObjectPointer], a","\tld a, b","\tld [wNamingScreenCursorObjectPointer + 1], a","\tld hl, SPRITEANIMSTRUCT_FRAMESET_ID","\tadd hl, bc","\tld a, [hl]","\tld hl, SPRITEANIMSTRUCT_0E","\tadd hl, bc","\tld [hl], a","\tld hl, wJumptableIndex","\tinc [hl]","\tret","",".process_joypad","\tld hl, hJoyPressed","\tld a, [hl]","\tand A_BUTTON","\tjr nz, .a","\tld a, [hl]","\tand B_BUTTON","\tjr nz, .b","\tld a, [hl]","\tand START","\tjr nz, .start","\tld a, [hl]","\tand SELECT","\tjr nz, .select","\tret","",".a","\tcall NamingScreen_PressedA_GetCursorCommand","\tcp $1","\tjr z, .select","\tcp $2","\tjr z, .b","\tcp $3","\tjr z, .finished","\tcall NamingScreen_GetLastCharacter","\tcall MailComposition_TryAddLastCharacter","\tjr c, .start","\tld hl, wNamingScreenCurNameLength","\tld a, [hl]","\tcp MAIL_LINE_LENGTH","\tret nz","\tinc [hl]","\tcall NamingScreen_GetTextCursorPosition","\tld [hl], NAMINGSCREEN_UNDERLINE","\tdec hl","\tld [hl], \"\u003cNEXT\u003e\"","\tret","",".start","\tld hl, wNamingScreenCursorObjectPointer","\tld c, [hl]","\tinc hl","\tld b, [hl]","\tld hl, SPRITEANIMSTRUCT_0C","\tadd hl, bc","\tld [hl], $9","\tld hl, SPRITEANIMSTRUCT_0D","\tadd hl, bc","\tld [hl], $5","\tret","",".b","\tcall NamingScreen_DeleteCharacter","\tld hl, wNamingScreenCurNameLength","\tld a, [hl]","\tcp MAIL_LINE_LENGTH","\tret nz","\tdec [hl]","\tcall NamingScreen_GetTextCursorPosition","\tld [hl], NAMINGSCREEN_UNDERLINE","\tinc hl","\tld [hl], \"\u003cNEXT\u003e\"","\tret","",".finished","\tcall NamingScreen_StoreEntry","\tld hl, wJumptableIndex","\tset 7, [hl]","\tret","",".select","\tld hl, wNamingScreenLetterCase","\tld a, [hl]","\txor 1","\tld [hl], a","\tjr nz, .switch_to_lowercase","\tld de, MailEntry_Uppercase","\tcall .PlaceMailCharset","\tret","",".switch_to_lowercase","\tld de, MailEntry_Lowercase","\tcall .PlaceMailCharset","\tret","","; called from engine/sprite_anims.asm"],"name":"_ComposeMailMessage","file":"engine/menus/naming_screen.asm","lineNo":900,"address":84875,"addressUsedBy":["ComposeMailMessage"]}