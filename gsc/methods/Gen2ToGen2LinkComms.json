{"names":["Gen2ToGen2LinkComms"],"callingMethods":["LinkCommunications","LinkTrade"],"methodsCalled":["ClearLinkData","ClearScreen","CopyBytes","DelayFrame","DelayFrames","ExchangeBytes","FarCall","FixDataForLinkTransfer","Function28b22","Function29dba","InitTradeMenuDisplay","LinkTimeout","Link_CopyOTData","Link_CopyRandomNumbers","Link_FindFirstNonControlCharacter_SkipZero","Link_PrepPartyData_Gen2","PlayMusic","Predef","ReturnToMapFromSubmenu","Serial_ExchangeBytes"],"methodAddressesUsed":["ConvertEnglishMailToFrenchGerman","ConvertEnglishMailToSpanishItalian","IsMailEuropean","Link_WaitBGMap","LoadPokemonData"],"varsSet":["hSerialSend","rIE","rIF","rSC","wDisableTextAcceleration","wOptions","wOtherTrainerClass","wUnusedD102"],"varsUsed":["hSerialConnectionStatus","rIE","rIF","wDisableTextAcceleration","wLinkMode","wScriptVar"],"varAddressesUsed":["StartBattlePredef","wEnemyMonSpecies","wLinkData","wLinkPlayerName","wLinkPlayerPartyMon1Species","wLink_c608","wOTClassName","wOTPartyCount","wOTPartyDataEnd","wOTPartyMonOT","wOTPlayerID","wOTPlayerName","wOptions","wPlayerTrademonSpecies","wc9f4","wcb0e","wcb84","wcc4a","wcc9e","wd1f3"],"constantsUsed":["CAL","JOYPAD","MAIL_MSG_LENGTH","MAIL_STRUCT_LENGTH","MUSIC_NONE","MUSIC_ROUTE_30","NAME_LENGTH","PARTY_LENGTH","SERIAL","SERIAL_NO_DATA_BYTE","TIMER","VBLANK","rSC_CLOCK","rSC_ON"],"lines":["Gen2ToGen2LinkComms:","\tcall ClearLinkData","\tcall Link_PrepPartyData_Gen2","\tcall FixDataForLinkTransfer","\tcall Function29dba","\tld a, [wScriptVar]","\tand a","\tjp z, LinkTimeout","\tldh a, [hSerialConnectionStatus]","\tcp USING_INTERNAL_CLOCK","\tjr nz, .Player1","","\tld c, 3","\tcall DelayFrames","\txor a","\tldh [hSerialSend], a","\tld a, (0 \u003c\u003c rSC_ON) | (1 \u003c\u003c rSC_CLOCK)","\tldh [rSC], a","\tld a, (1 \u003c\u003c rSC_ON) | (1 \u003c\u003c rSC_CLOCK)","\tldh [rSC], a","","\tcall DelayFrame","\txor a","\tldh [hSerialSend], a","\tld a, (0 \u003c\u003c rSC_ON) | (1 \u003c\u003c rSC_CLOCK)","\tldh [rSC], a","\tld a, (1 \u003c\u003c rSC_ON) | (1 \u003c\u003c rSC_CLOCK)","\tldh [rSC], a","",".Player1:","\tld de, MUSIC_NONE","\tcall PlayMusic","\tld c, 3","\tcall DelayFrames","\txor a","\tldh [rIF], a","\tld a, 1 \u003c\u003c SERIAL","\tldh [rIE], a","\tld hl, wd1f3","\tld de, wEnemyMonSpecies","\tld bc, $11","\tcall Serial_ExchangeBytes","\tld a, SERIAL_NO_DATA_BYTE","\tld [de], a","\tld hl, wLinkData","\tld de, wOTPlayerName","\tld bc, $1c2","\tcall Serial_ExchangeBytes","\tld a, SERIAL_NO_DATA_BYTE","\tld [de], a","\tld hl, wLink_c608","\tld de, wTrademons","\tld bc, wTrademons - wLink_c608","\tcall Serial_ExchangeBytes","\tld a, [wLinkMode]","\tcp LINK_TRADECENTER","\tjr nz, .not_trading","\tld hl, wc9f4","\tld de, wcb84","\tld bc, $186","\tcall ExchangeBytes","",".not_trading","\txor a","\tldh [rIF], a","\tld a, (1 \u003c\u003c JOYPAD) | (1 \u003c\u003c SERIAL) | (1 \u003c\u003c TIMER) | (1 \u003c\u003c VBLANK)","\tldh [rIE], a","\tld de, MUSIC_NONE","\tcall PlayMusic","\tcall Link_CopyRandomNumbers","\tld hl, wOTPlayerName","\tcall Link_FindFirstNonControlCharacter_SkipZero","\tld de, wLinkData","\tld bc, $1b9","\tcall Link_CopyOTData","\tld de, wPlayerTrademonSpecies","\tld hl, wLinkPlayerPartyMon1Species","\tld c, 2",".loop1","\tld a, [de]","\tinc de","\tand a","\tjr z, .loop1","\tcp SERIAL_PREAMBLE_BYTE","\tjr z, .loop1","\tcp SERIAL_NO_DATA_BYTE","\tjr z, .loop1","\tcp SERIAL_PATCH_LIST_PART_TERMINATOR","\tjr z, .next1","\tpush hl","\tpush bc","\tld b, 0","\tdec a","\tld c, a","\tadd hl, bc","\tld a, SERIAL_NO_DATA_BYTE","\tld [hl], a","\tpop bc","\tpop hl","\tjr .loop1","",".next1","\tld hl, wc90f","\tdec c","\tjr nz, .loop1","\tld a, [wLinkMode]","\tcp LINK_TRADECENTER","\tjp nz, .skip_mail","\tld hl, wcb84",".loop2","\tld a, [hli]","\tcp MAIL_MSG_LENGTH","\tjr nz, .loop2",".loop3","\tld a, [hli]","\tcp SERIAL_NO_DATA_BYTE","\tjr z, .loop3","\tcp MAIL_MSG_LENGTH","\tjr z, .loop3","\tdec hl","\tld de, wcb84","\tld bc, $190 ; 400","\tcall CopyBytes","\tld hl, wcb84","\tld bc, $c6 ; 198",".loop4","\tld a, [hl]","\tcp MAIL_MSG_LENGTH + 1","\tjr nz, .okay1","\tld [hl], SERIAL_NO_DATA_BYTE",".okay1","\tinc hl","\tdec bc","\tld a, b","\tor c","\tjr nz, .loop4","\tld de, wcc9e",".loop5","\tld a, [de]","\tinc de","\tcp SERIAL_PATCH_LIST_PART_TERMINATOR","\tjr z, .start_copying_mail","\tld hl, wcc4a","\tdec a","\tld b, $0","\tld c, a","\tadd hl, bc","\tld [hl], SERIAL_NO_DATA_BYTE","\tjr .loop5","",".start_copying_mail","\tld hl, wcb84","\tld de, wc9f4","\tld b, PARTY_LENGTH",".copy_mail_loop","\tpush bc","\tld bc, MAIL_MSG_LENGTH + 1","\tcall CopyBytes","\tld a, LOW(MAIL_STRUCT_LENGTH - (MAIL_MSG_LENGTH + 1))","\tadd e","\tld e, a","\tld a, HIGH(MAIL_STRUCT_LENGTH - (MAIL_MSG_LENGTH + 1))","\tadc d","\tld d, a","\tpop bc","\tdec b","\tjr nz, .copy_mail_loop","\tld de, wc9f4","\tld b, PARTY_LENGTH",".copy_author_loop","\tpush bc","\tld a, LOW(MAIL_MSG_LENGTH + 1)","\tadd e","\tld e, a","\tld a, HIGH(MAIL_MSG_LENGTH + 1)","\tadc d","\tld d, a","\tld bc, MAIL_STRUCT_LENGTH - (MAIL_MSG_LENGTH + 1)","\tcall CopyBytes","\tpop bc","\tdec b","\tjr nz, .copy_author_loop","\tld b, PARTY_LENGTH","\tld de, wc9f4",".fix_mail_loop","\tpush bc","\tpush de","\tfarcall IsMailEuropean","\tld a, c","\tor a","\tjr z, .next","\tsub $3","\tjr nc, .skip","\tfarcall ConvertEnglishMailToFrenchGerman","\tjr .next","",".skip","\tcp $2","\tjr nc, .next","\tfarcall ConvertEnglishMailToSpanishItalian","",".next","\tpop de","\tld hl, MAIL_STRUCT_LENGTH","\tadd hl, de","\tld d, h","\tld e, l","\tpop bc","\tdec b","\tjr nz, .fix_mail_loop","\tld de, wcb0e","\txor a","\tld [de], a","",".skip_mail","\tld hl, wLinkPlayerName","\tld de, wOTPlayerName","\tld bc, NAME_LENGTH","\tcall CopyBytes","\tld de, wOTPartyCount","\tld bc, 1 + PARTY_LENGTH + 1","\tcall CopyBytes","\tld de, wOTPlayerID","\tld bc, 2","\tcall CopyBytes","\tld de, wOTPartyMons","\tld bc, wOTPartyDataEnd - wOTPartyMons","\tcall CopyBytes","\tld a, LOW(wOTPartyMonOT)","\tld [wUnusedD102], a","\tld a, HIGH(wOTPartyMonOT)","\tld [wUnusedD102 + 1], a","\tld de, MUSIC_NONE","\tcall PlayMusic","\tldh a, [hSerialConnectionStatus]","\tcp USING_INTERNAL_CLOCK","\tld c, 66","\tcall z, DelayFrames","\tld a, [wLinkMode]","\tcp LINK_COLOSSEUM","\tjr nz, .ready_to_trade","\tld a, CAL","\tld [wOtherTrainerClass], a","\tcall ClearScreen","\tfarcall Link_WaitBGMap","\tld hl, wOptions","\tld a, [hl]","\tpush af","\tand 1 \u003c\u003c STEREO","\tor TEXT_DELAY_MED","\tld [hl], a","\tld hl, wOTPlayerName","\tld de, wOTClassName","\tld bc, NAME_LENGTH","\tcall CopyBytes","\tcall ReturnToMapFromSubmenu","","\t; LET\u0027S DO THIS","\tld a, [wDisableTextAcceleration]","\tpush af","\tld a, 1","\tld [wDisableTextAcceleration], a","\tldh a, [rIE]","\tpush af","\tldh a, [rIF]","\tpush af","\txor a","\tldh [rIF], a","\tldh a, [rIE]","\tset LCD_STAT, a","\tldh [rIE], a","\tpop af","\tldh [rIF], a","","\tpredef StartBattle","","\tldh a, [rIF]","\tld h, a","\txor a","\tldh [rIF], a","\tpop af","\tldh [rIE], a","\tld a, h","\tldh [rIF], a","\tpop af","\tld [wDisableTextAcceleration], a","\tpop af","\tld [wOptions], a","\tfarcall LoadPokemonData","\tjp Function28b22","",".ready_to_trade","\tld de, MUSIC_ROUTE_30","\tcall PlayMusic","\tjp InitTradeMenuDisplay"],"name":"Gen2ToGen2LinkComms","file":"engine/link/link.asm","lineNo":181,"address":102480,"addressUsedBy":[]}