{"names":["GivePokerusAndConvertBerries"],"callingMethods":[],"methodsCalled":["ConvertBerriesToBerryJuice","GetPartyLocation","Random"],"methodAddressesUsed":[],"varsSet":[],"varsUsed":["hRandomAdd","hRandomSub","wPartyCount"],"varAddressesUsed":["wPartyMon1PokerusStatus","wStatusFlags2"],"constantsUsed":["PARTYMON_STRUCT_LENGTH"],"lines":["GivePokerusAndConvertBerries:","\tcall ConvertBerriesToBerryJuice","\tld hl, wPartyMon1PokerusStatus","\tld a, [wPartyCount]","\tld b, a","\tld de, PARTYMON_STRUCT_LENGTH","; Check to see if any of your Pokemon already has Pokerus.","; If so, sample its spread through your party.","; This means that you cannot get Pokerus de novo while","; a party member has an active infection.",".loopMons","\tld a, [hl]","\tand $f","\tjr nz, .TrySpreadPokerus","\tadd hl, de","\tdec b","\tjr nz, .loopMons","","; If we haven\u0027t been to Goldenrod City at least once,","; prevent the contraction of Pokerus.","\tld hl, wStatusFlags2","\tbit STATUSFLAGS2_REACHED_GOLDENROD_F, [hl]","\tret z","\tcall Random","\tldh a, [hRandomAdd]","\tand a","\tret nz","\tldh a, [hRandomSub]","\tcp 3","\tret nc ; 3/65536 chance (00 00, 00 01 or 00 02)","\tld a, [wPartyCount]","\tld b, a",".randomMonSelectLoop","\tcall Random","\tand $7","\tcp b","\tjr nc, .randomMonSelectLoop","\tld hl, wPartyMon1PokerusStatus","\tcall GetPartyLocation ; get pokerus byte of random mon","\tld a, [hl]","\tand $f0","\tret nz ; if it already has pokerus, do nothing",".randomPokerusLoop ; Simultaneously sample the strain and duration","\tcall Random","\tand a","\tjr z, .randomPokerusLoop","\tld b, a","\tand $f0","\tjr z, .load_pkrs","\tld a, b","\tand $7","\tinc a",".load_pkrs","\tld b, a ; this should come before the label","\tswap b","\tand $3","\tinc a","\tadd b","\tld [hl], a","\tret","",".TrySpreadPokerus:","\tcall Random","\tcp 33 percent + 1","\tret nc ; 1/3 chance","","\tld a, [wPartyCount]","\tcp 1","\tret z ; only one mon, nothing to do","","\tld c, [hl]","\tld a, b","\tcp 2","\tjr c, .checkPreviousMonsLoop ; no more mons after this one, go backwards","","\tcall Random","\tcp 50 percent + 1","\tjr c, .checkPreviousMonsLoop ; 1/2 chance, go backwards",".checkFollowingMonsLoop","\tadd hl, de","\tld a, [hl]","\tand a","\tjr z, .infectMon","\tld c, a","\tand $3","\tret z ; if mon has cured pokerus, stop searching","\tdec b ; go on to next mon","\tld a, b","\tcp 1","\tjr nz, .checkFollowingMonsLoop ; no more mons left","\tret","",".checkPreviousMonsLoop","\tld a, [wPartyCount]","\tcp b","\tret z ; no more mons","\tld a, l","\tsub e","\tld l, a","\tld a, h","\tsbc d","\tld h, a","\tld a, [hl]","\tand a","\tjr z, .infectMon","\tld c, a","\tand $3","\tret z ; if mon has cured pokerus, stop searching","\tinc b ; go on to next mon","\tjr .checkPreviousMonsLoop","",".infectMon","\tld a, c","\tand $f0","\tld b, a","\tld a, c","\tswap a","\tand $3","\tinc a","\tadd b","\tld [hl], a","\tret"],"name":"GivePokerusAndConvertBerries","file":"engine/events/pokerus/pokerus.asm","lineNo":1,"address":116074,"addressUsedBy":["ExitBattle"]}