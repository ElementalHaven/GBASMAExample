{"names":["CheckTypeMatchup"],"callingMethods":["BattleCheckTypeMatchup","CheckPlayerMoveTypeMatchups","FindEnemyMonsImmuneToLastCounterMove","FindEnemyMonsThatResistPlayer","FindEnemyMonsWithASuperEffectiveMove"],"methodsCalled":["Divide","GetBattleVar","Multiply"],"methodAddressesUsed":[],"varsSet":["hDividend","hDivisor","hMultiplicand","hMultiplier","wTypeMatchup"],"varsUsed":["hQuotient","wTypeMatchup"],"varAddressesUsed":["TypeMatchups"],"constantsUsed":["BATTLE_VARS_MOVE_TYPE","BATTLE_VARS_SUBSTATUS1_OPP"],"lines":["CheckTypeMatchup:","; There is an incorrect assumption about this function made in the AI related code: when","; the AI calls CheckTypeMatchup (not BattleCheckTypeMatchup), it assumes that placing the","; offensive type in a will make this function do the right thing. Since a is overwritten,","; this assumption is incorrect. A simple fix would be to load the move type for the","; current move into a in BattleCheckTypeMatchup, before falling through, which is","; consistent with how the rest of the code assumes this code works like.","\tpush hl","\tpush de","\tpush bc","\tld a, BATTLE_VARS_MOVE_TYPE","\tcall GetBattleVar","\tld d, a","\tld b, [hl]","\tinc hl","\tld c, [hl]","\tld a, 10 ; 1.0","\tld [wTypeMatchup], a","\tld hl, TypeMatchups",".TypesLoop:","\tld a, [hli]","\tcp -1","\tjr z, .End","\tcp -2","\tjr nz, .Next","\tld a, BATTLE_VARS_SUBSTATUS1_OPP","\tcall GetBattleVar","\tbit SUBSTATUS_IDENTIFIED, a","\tjr nz, .End","\tjr .TypesLoop","",".Next:","\tcp d","\tjr nz, .Nope","\tld a, [hli]","\tcp b","\tjr z, .Yup","\tcp c","\tjr z, .Yup","\tjr .Nope2","",".Nope:","\tinc hl",".Nope2:","\tinc hl","\tjr .TypesLoop","",".Yup:","\txor a","\tldh [hDividend + 0], a","\tldh [hMultiplicand + 0], a","\tldh [hMultiplicand + 1], a","\tld a, [hli]","\tldh [hMultiplicand + 2], a","\tld a, [wTypeMatchup]","\tldh [hMultiplier], a","\tcall Multiply","\tld a, 10","\tldh [hDivisor], a","\tpush bc","\tld b, 4","\tcall Divide","\tpop bc","\tldh a, [hQuotient + 3]","\tld [wTypeMatchup], a","\tjr .TypesLoop","",".End:","\tpop bc","\tpop de","\tpop hl","\tret"],"name":"CheckTypeMatchup","file":"engine/battle/effect_commands.asm","lineNo":1411,"address":117385,"addressUsedBy":[]}