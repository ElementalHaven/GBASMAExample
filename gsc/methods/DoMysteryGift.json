{"names":["DoMysteryGift"],"callingMethods":["DoMysteryGift"],"methodsCalled":["ClearSprites","ClearTilemap","CloseSRAM","CopyBytes","DoMysteryGift","EnableLCD","FarCall","Function104a95","GetItemName","GetMysteryGiftBank","GetSGBLayout","InitMysteryGiftLayout","MysteryGift_CheckAndSetDecorationAlreadyReceived","MysteryGift_ClearTrainerData","PlaceString","PrintText","SetPalettes","WaitBGMap"],"methodAddressesUsed":["BackupMobileEventIndex","GetDecorationName_c","MysteryGiftGetDecoration","MysteryGiftGetItemHeldEffect","PrepMysteryGiftDataToSend","RestoreMobileEventIndex","StubbedTrainerRankings_MysteryGift"],"varsSet":["rIE","rIF","rLCDC","sBackupMysteryGiftItem","sMysteryGiftTrainerHouseFlag","wNamedObjectIndexBuffer","wca01","wca02"],"varsUsed":["rIE","sNumDailyMysteryGiftPartnerIDs","wMysteryGiftPartnerBackupItem","wMysteryGiftPartnerID","wMysteryGiftPartnerSentDeco","wMysteryGiftPartnerWhichDeco","wMysteryGiftPartnerWhichItem","wMysteryGiftPlayerBackupItem","wc900"],"varAddressesUsed":["sDailyMysteryGiftPartnerIDs","sMysteryGiftPartnerName","sNumDailyMysteryGiftPartnerIDs","wMysteryGiftPartnerName","wMysteryGiftTrainerData","wStringBuffer1"],"constantsUsed":["ITEM_NAME_LENGTH","LCDC_DEFAULT","NAME_LENGTH","NUM_MOVES","PARTY_LENGTH","SCGB_DIPLOMA"],"lines":["DoMysteryGift:","\tcall ClearTilemap","\tcall ClearSprites","\tcall WaitBGMap","\tcall InitMysteryGiftLayout","\thlcoord 3, 8","\tld de, .String_PressAToLink_BToCancel","\tcall PlaceString","\tcall WaitBGMap","\tfarcall PrepMysteryGiftDataToSend","\tcall MysteryGift_ClearTrainerData","\tld a, $2","\tld [wca01], a","\tld a, $14","\tld [wca02], a","\tldh a, [rIE]","\tpush af","","\tcall Function104a95","","\tld d, a","\txor a","\tldh [rIF], a","\tpop af","\tldh [rIE], a","\tpush de","\tcall ClearTilemap","\tcall EnableLCD","\tcall WaitBGMap","\tld b, SCGB_DIPLOMA","\tcall GetSGBLayout","\tcall SetPalettes","\tpop de","\thlcoord 2, 8","\tld a, d","\tld de, .MysteryGiftCanceledText ; Link has been canceled","\tcp $10","\tjp z, .LinkCanceled","\tcp $6c","\tjp nz, .CommunicationError","\tld a, [wc900]","\tcp 3","\tjr z, .skip_checks","\tcall .CheckAlreadyGotFiveGiftsToday","\tld hl, .MysteryGiftFiveADayText ; Only 5 gifts a day","\tjp nc, .PrintTextAndExit","\tcall .CheckAlreadyGotAGiftFromThatPerson","\tld hl, .MysteryGiftOneADayText ; Only one gift a day per person","\tjp c, .PrintTextAndExit",".skip_checks","\tld a, [wMysteryGiftPlayerBackupItem]","\tand a","\tjp nz, .GiftWaiting","\tld a, [wMysteryGiftPartnerBackupItem]","\tand a","\tjp nz, .FriendNotReady","\tld a, [wc900]","\tcp 3","\tjr z, .skip_append_save","\tcall .AddMysteryGiftPartnerID","\tld a, [wc900]","\tcp 4","\tjr z, .skip_append_save","\tcall .SaveMysteryGiftTrainerName","\tfarcall RestoreMobileEventIndex","\tfarcall StubbedTrainerRankings_MysteryGift","\tfarcall BackupMobileEventIndex",".skip_append_save","\tld a, [wMysteryGiftPartnerSentDeco]","\tand a","\tjr z, .item","\tld a, [wMysteryGiftPartnerWhichDeco]","\tld c, a","\tfarcall MysteryGiftGetDecoration","\tpush bc","\tcall MysteryGift_CheckAndSetDecorationAlreadyReceived","\tpop bc","\tjr nz, .item","\tcallfar GetDecorationName_c","\tld h, d","\tld l, e","\tld de, wStringBuffer1","\tld bc, ITEM_NAME_LENGTH","\tcall CopyBytes","\tld hl, .MysteryGiftSentHomeText ; sent decoration to home","\tjr .PrintTextAndExit","",".item","\tcall GetMysteryGiftBank","\tld a, [wMysteryGiftPartnerWhichItem]","\tld c, a","\tfarcall MysteryGiftGetItemHeldEffect","\tld a, c","\tld [sBackupMysteryGiftItem], a","\tld [wNamedObjectIndexBuffer], a","\tcall CloseSRAM","\tcall GetItemName","\tld hl, .MysteryGiftSentText ; sent item","\tjr .PrintTextAndExit","",".LinkCanceled:","\tld hl, .MysteryGiftCanceledText ; Link has been canceled","\tjr .PrintTextAndExit","",".CommunicationError:","\tld hl, .MysteryGiftCommErrorText ; Communication error","\tcall PrintText","\tjp DoMysteryGift","",".GiftWaiting:","\tld hl, .RetrieveMysteryGiftText ; receive gift at counter","\tjr .PrintTextAndExit","",".FriendNotReady:","\tld hl, .YourFriendIsNotReadyText ; friend not ready","",".PrintTextAndExit:","\tcall PrintText","\tld a, LCDC_DEFAULT","\tldh [rLCDC], a","\tret","",".String_PressAToLink_BToCancel:","\tdb   \"Press A to\"","\tnext \"link IR-Device\"","\tnext \"Press B to\"","\tnext \"cancel it.\"","\tdb   \"@\"","",".MysteryGiftCanceledText:","\ttext_far _MysteryGiftCanceledText","\ttext_end","",".MysteryGiftCommErrorText:","\ttext_far _MysteryGiftCommErrorText","\ttext_end","",".RetrieveMysteryGiftText:","\ttext_far _RetrieveMysteryGiftText","\ttext_end","",".YourFriendIsNotReadyText:","\ttext_far _YourFriendIsNotReadyText","\ttext_end","",".MysteryGiftFiveADayText:","\ttext_far _MysteryGiftFiveADayText","\ttext_end","",".MysteryGiftOneADayText:","\ttext_far _MysteryGiftOneADayText","\ttext_end","",".MysteryGiftSentText:","\ttext_far _MysteryGiftSentText","\ttext_end","",".MysteryGiftSentHomeText:","\ttext_far _MysteryGiftSentHomeText","\ttext_end","",".CheckAlreadyGotFiveGiftsToday:","\tcall GetMysteryGiftBank","\tld a, [sNumDailyMysteryGiftPartnerIDs]","\tcp $5","\tjp CloseSRAM","",".CheckAlreadyGotAGiftFromThatPerson:","\tcall GetMysteryGiftBank","\tld a, [wMysteryGiftPartnerID]","\tld b, a","\tld a, [wMysteryGiftPartnerID + 1]","\tld c, a","\tld a, [sNumDailyMysteryGiftPartnerIDs]","\tld d, a","\tld hl, sDailyMysteryGiftPartnerIDs",".loop","\tld a, d","\tand a","\tjr z, .No","\tld a, [hli]","\tcp b","\tjr nz, .skip","\tld a, [hl]","\tcp c","\tjr z, .Yes",".skip","\tinc hl","\tdec d","\tjr .loop",".Yes:","\tscf",".No:","\tjp CloseSRAM","",".AddMysteryGiftPartnerID:","\tcall GetMysteryGiftBank","\tld hl, sNumDailyMysteryGiftPartnerIDs","\tld a, [hl]","\tinc [hl]","\tld hl, sDailyMysteryGiftPartnerIDs ; inc hl","\tld e, a","\tld d, $0","\tadd hl, de","\tadd hl, de","\tld a, [wMysteryGiftPartnerID]","\tld [hli], a","\tld a, [wMysteryGiftPartnerID + 1]","\tld [hl], a","\tjp CloseSRAM","",".SaveMysteryGiftTrainerName:","\tcall GetMysteryGiftBank","\tld a, $1","\tld [sMysteryGiftTrainerHouseFlag], a","\tld hl, wMysteryGiftPartnerName","\tld de, sMysteryGiftPartnerName","\tld bc, NAME_LENGTH","\tcall CopyBytes","\tld a, $1","\tld [de], a","\tinc de","\tld hl, wMysteryGiftTrainerData","\tld bc, (1 + 1 + NUM_MOVES) * PARTY_LENGTH + 2","\tcall CopyBytes","\tjp CloseSRAM"],"name":"DoMysteryGift","file":"engine/link/mystery_gift.asm","lineNo":1,"address":262858,"addressUsedBy":["MysteryGift"]}